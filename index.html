<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Study Analytics Pro - Team Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root {
      --primary: #4cc9f0;
      --secondary: #f72585;
      --success: #4ade80;
      --warning: #fbbf24;
      --danger: #ef4444;
      --dark: #1a1a2e;
      --darker: #16213e;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
      color: white;
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
    }
    
    h1 {
      font-size: 2.8em;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }
    
    .subtitle {
      color: #a5b4fc;
      font-size: 1.2em;
      opacity: 0.9;
    }
    
    /* Admin Section */
    .admin-section {
      background: linear-gradient(135deg, rgba(76, 201, 240, 0.1), rgba(247, 37, 133, 0.1));
      padding: 20px;
      border-radius: 15px;
      margin: 20px 0;
      border-left: 4px solid var(--primary);
      position: relative;
    }
    
    .admin-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--primary);
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: bold;
    }
    
    .admin-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .admin-input {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      padding: 12px;
      color: white;
      width: 100%;
    }
    
    .admin-input:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .lock-toggle {
      background: var(--warning);
      color: var(--dark);
      border: none;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: bold;
      margin-top: 10px;
    }
    
    /* Controls */
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 30px 0;
    }
    
    .btn {
      padding: 15px 20px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn-primary { background: linear-gradient(135deg, var(--primary), #4361ee); }
    .btn-success { background: linear-gradient(135deg, var(--success), #22c55e); }
    .btn-warning { background: linear-gradient(135deg, var(--warning), #d97706); }
    .btn-danger { background: linear-gradient(135deg, var(--danger), #dc2626); }
    .btn-secondary { background: linear-gradient(135deg, #a855f7, #7c3aed); }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Quick Actions */
    .quick-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .quick-btn {
      padding: 10px 15px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .quick-btn:hover {
      background: rgba(255,255,255,0.2);
    }
    
    /* Members Grid */
    .members-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .member-card {
      background: rgba(30, 30, 46, 0.9);
      padding: 20px;
      border-radius: 15px;
      border-left: 4px solid;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }
    
    .member-card:hover {
      transform: translateY(-5px);
    }
    
    .member-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .member-name {
      font-weight: bold;
      font-size: 1.3em;
    }
    
    .member-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2em;
    }
    
    .day-section {
      background: rgba(44, 44, 64, 0.6);
      padding: 15px;
      border-radius: 10px;
      margin: 12px 0;
    }
    
    .day-header {
      color: var(--warning);
      font-weight: bold;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .input-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .input-label {
      font-size: 0.85em;
      color: #a5b4fc;
      font-weight: 500;
    }
    
    input {
      padding: 10px;
      border: 1px solid #4b5563;
      border-radius: 8px;
      background: rgba(30, 30, 46, 0.9);
      color: white;
      text-align: center;
      transition: border-color 0.3s;
    }
    
    input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.1);
    }
    
    /* Results Section */
    .results-section {
      background: rgba(30, 30, 46, 0.9);
      padding: 30px;
      border-radius: 20px;
      margin-top: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .results-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #4361ee, #3a0ca3);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      transition: transform 0.3s;
    }
    
    .stat-card:hover {
      transform: scale(1.05);
    }
    
    .stat-value {
      font-size: 2.2em;
      font-weight: bold;
      margin: 10px 0;
    }
    
    /* Rankings */
    .rankings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .ranking-card {
      background: rgba(44, 44, 64, 0.8);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    
    .ranking-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
    }
    
    .rank-1 {
      border-color: var(--warning);
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(44, 44, 64, 0.9));
      position: relative;
    }
    
    .rank-1::before {
      content: "üëë";
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2.5em;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
    }
    
    .rank-last {
      border-color: var(--danger);
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(44, 44, 64, 0.9));
    }
    
    .percentage {
      font-size: 2.8em;
      font-weight: bold;
      margin: 15px 0;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .progress-bar {
      width: 100%;
      height: 10px;
      background: #374151;
      border-radius: 10px;
      margin: 15px 0;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      border-radius: 10px;
      transition: width 0.8s ease;
      background: linear-gradient(90deg, var(--primary), var(--success));
    }
    
    /* Achievements */
    .achievements {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin: 25px 0;
    }
    
    .badge {
      background: linear-gradient(135deg, var(--warning), var(--danger));
      padding: 10px 18px;
      border-radius: 25px;
      font-size: 0.9em;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Recommendations */
    .recommendations {
      background: linear-gradient(135deg, rgba(76, 201, 240, 0.1), rgba(247, 37, 133, 0.1));
      padding: 20px;
      border-radius: 15px;
      margin: 25px 0;
      border-left: 4px solid var(--primary);
    }
    
    .recommendation {
      margin: 10px 0;
      padding: 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }
    
    /* Export Section */
    .export-section {
      text-align: center;
      margin-top: 30px;
      padding: 20px;
      background: rgba(44, 44, 64, 0.6);
      border-radius: 15px;
    }
    
    .export-options {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.success { background: var(--success); }
    .notification.error { background: var(--danger); }
    .notification.info { background: var(--primary); }
    
    /* Responsive */
    @media (max-width: 768px) {
      .members-grid {
        grid-template-columns: 1fr;
      }
      
      .controls {
        grid-template-columns: 1fr;
      }
      
      .export-options {
        flex-direction: column;
        align-items: center;
      }
      
      h1 {
        font-size: 2.2em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéØ Study Analytics Pro</h1>
      <p class="subtitle">Admin-Controlled Team Dashboard ‚Ä¢ Advanced Reporting</p>
    </header>

    <!-- Admin Section - Only You Can Modify -->
    <div class="admin-section">
      <div class="admin-badge">ADMIN CONTROLS</div>
      <h3>‚öôÔ∏è Study Goals & Settings</h3>
      <div class="admin-controls">
        <div>
          <div class="input-label">Minimum Daily Study (hours)</div>
          <input type="number" id="minStudyGoal" value="4" min="1" max="12" class="admin-input" disabled>
        </div>
        <div>
          <div class="input-label">Target Efficiency (%)</div>
          <input type="number" id="targetEfficiency" value="50" min="10" max="100" class="admin-input" disabled>
        </div>
        <div>
          <div class="input-label">Team Challenge Goal (%)</div>
          <input type="number" id="teamGoal" value="55" min="10" max="100" class="admin-input" disabled>
        </div>
      </div>
      <button class="lock-toggle" onclick="toggleAdminLock()">üîì Unlock to Edit Goals</button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button class="quick-btn" onclick="fillSampleData()">üé≤ Sample Data</button>
      <button class="quick-btn" onclick="quickEntryMode()">‚ö° Quick Entry</button>
      <button class="quick-btn" onclick="showTutorial()">üìö Tutorial</button>
    </div>

    <!-- Main Controls -->
    <div class="controls">
      <button class="btn btn-primary" onclick="calculateResults()">
        <span>üìà</span> Calculate Analytics
      </button>
      <button class="btn btn-success" onclick="saveProgress()">
        <span>üíæ</span> Save Progress
      </button>
      <button class="btn btn-secondary" onclick="showExportOptions()">
        <span>üìä</span> Export Reports
      </button>
      <button class="btn btn-danger" onclick="resetAll()">
        <span>üîÑ</span> Reset All
      </button>
    </div>

    <!-- Members Input -->
    <div class="members-grid" id="membersContainer"></div>

    <!-- Results Section -->
    <div class="results-section" id="resultsSection" style="display: none;">
      <div class="results-header">
        <h2>üèÜ Team Performance Dashboard</h2>
        <p>Comprehensive analysis based on 3 days of tracking</p>
      </div>

      <!-- Team Stats -->
      <div class="stats-grid" id="teamStats"></div>

      <!-- Achievements -->
      <div class="achievements" id="achievementsContainer"></div>

      <!-- Recommendations -->
      <div class="recommendations" id="recommendationsContainer"></div>

      <!-- Rankings -->
      <div class="rankings-grid" id="rankingsContainer"></div>

      <!-- Export Options -->
      <div class="export-section" id="exportSection" style="display: none;">
        <h3>üì• Export Reports</h3>
        <p>Choose your preferred format:</p>
        <div class="export-options">
          <button class="btn btn-warning" onclick="exportToPDF()">
            <span>üìÑ</span> Download PDF Report
          </button>
          <button class="btn btn-success" onclick="exportToCSV()">
            <span>üìä</span> Download CSV Data
          </button>
          <button class="btn btn-primary" onclick="exportToImage()">
            <span>üñºÔ∏è</span> Save as Image
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div id="notification" class="notification"></div>

  <script>
    // Initialize jsPDF
    const { jsPDF } = window.jspdf;

    const members = [
      { id: 1, name: "ABHINAV AP", color: "#4cc9f0", avatar: "A" },
      { id: 2, name: "VAISHNAV C", color: "#f72585", avatar: "V" },
      { id: 3, name: "ALAN JACOB", color: "#4ade80", avatar: "A" },
      { id: 4, name: "MUHAMMED ZAMEEL U", color: "#fbbf24", avatar: "M" },
      { id: 5, name: "JOEL PB", color: "#a855f7", avatar: "J" },
      { id: 6, name: "JIMIL GEORGE", color: "#06d6a0", avatar: "J" },
      { id: 7, name: "AROMAL AM", color: "#ff6b6b", avatar: "A" }
    ];

    let adminUnlocked = false;
    let currentResults = null;

    // Initialize
    loadMemberCards();
    loadSavedData();

    function toggleAdminLock() {
      adminUnlocked = !adminUnlocked;
      const inputs = document.querySelectorAll('.admin-input');
      const button = document.querySelector('.lock-toggle');
      
      inputs.forEach(input => {
        input.disabled = !adminUnlocked;
      });
      
      if (adminUnlocked) {
        button.innerHTML = 'üîí Lock Goals';
        button.style.background = '#ef4444';
        showNotification('Admin mode unlocked! You can now modify goals.', 'success');
      } else {
        button.innerHTML = 'üîì Unlock to Edit Goals';
        button.style.background = '#fbbf24';
        showNotification('Admin mode locked. Goals are secure.', 'info');
      }
    }

    function loadMemberCards() {
      const container = document.getElementById('membersContainer');
      container.innerHTML = '';

      members.forEach(member => {
        const card = `
          <div class="member-card" style="border-left-color: ${member.color}">
            <div class="member-header">
              <div class="member-name" style="color: ${member.color}">
                ${member.name}
              </div>
              <div class="member-avatar" style="background: ${member.color}">
                ${member.avatar}
              </div>
            </div>
            
            ${[1, 2, 3].map(day => `
              <div class="day-section">
                <div class="day-header">
                  <span>üìÖ Day ${day}</span>
                  <span style="font-size: 0.8em; opacity: 0.7;" id="m${member.id}d${day}Status"></span>
                </div>
                <div class="input-grid">
                  <div class="input-group">
                    <div class="input-label">üìö Study Hours</div>
                    <input type="number" id="m${member.id}d${day}StudyH" placeholder="0" min="0" 
                           onchange="updateDayStatus(${member.id}, ${day})">
                  </div>
                  <div class="input-group">
                    <div class="input-label">Study Minutes</div>
                    <input type="number" id="m${member.id}d${day}StudyM" placeholder="0" min="0" max="59"
                           onchange="updateDayStatus(${member.id}, ${day})">
                  </div>
                  <div class="input-group">
                    <div class="input-label">üì± Screen Hours</div>
                    <input type="number" id="m${member.id}d${day}ScreenH" placeholder="0" min="0"
                           onchange="updateDayStatus(${member.id}, ${day})">
                  </div>
                  <div class="input-group">
                    <div class="input-label">Screen Minutes</div>
                    <input type="number" id="m${member.id}d${day}ScreenM" placeholder="0" min="0" max="59"
                           onchange="updateDayStatus(${member.id}, ${day})">
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        `;
        container.innerHTML += card;
      });
    }

    function updateDayStatus(memberId, day) {
      const studyH = parseInt(document.getElementById(`m${memberId}d${day}StudyH`).value) || 0;
      const studyM = parseInt(document.getElementById(`m${memberId}d${day}StudyM`).value) || 0;
      const screenH = parseInt(document.getElementById(`m${memberId}d${day}ScreenH`).value) || 0;
      const screenM = parseInt(document.getElementById(`m${memberId}d${day}ScreenM`).value) || 0;
      
      const totalStudy = studyH * 60 + studyM;
      const totalScreen = screenH * 60 + screenM;
      const percentage = totalScreen > 0 ? (totalStudy / totalScreen * 100) : 0;
      
      const statusEl = document.getElementById(`m${memberId}d${day}Status`);
      if (totalStudy > 0 || totalScreen > 0) {
        statusEl.textContent = `‚úì ${percentage.toFixed(0)}%`;
        statusEl.style.color = percentage >= 40 ? '#4ade80' : '#fbbf24';
      } else {
        statusEl.textContent = '';
      }
    }

    function fillSampleData() {
      members.forEach(member => {
        for (let day = 1; day <= 3; day++) {
          document.getElementById(`m${member.id}d${day}StudyH`).value = Math.floor(Math.random() * 4) + 2;
          document.getElementById(`m${member.id}d${day}StudyM`).value = Math.floor(Math.random() * 60);
          document.getElementById(`m${member.id}d${day}ScreenH`).value = Math.floor(Math.random() * 6) + 4;
          document.getElementById(`m${member.id}d${day}ScreenM`).value = Math.floor(Math.random() * 60);
          updateDayStatus(member.id, day);
        }
      });
      showNotification('Sample data filled! Click "Calculate Analytics" to see results.', 'success');
    }

    function quickEntryMode() {
      members.forEach(member => {
        for (let day = 1; day <= 3; day++) {
          if (!document.getElementById(`m${member.id}d${day}StudyH`).value) {
            document.getElementById(`m${member.id}d${day}StudyH`).value = 4;
            document.getElementById(`m${member.id}d${day}StudyM`).value = 30;
            document.getElementById(`m${member.id}d${day}ScreenH`).value = 6;
            document.getElementById(`m${member.id}d${day}ScreenM`).value = 0;
            updateDayStatus(member.id, day);
          }
        }
      });
      showNotification('Quick entry completed! Modify values as needed.', 'info');
    }

    function calculateResults() {
      const results = [];
      const minStudyGoal = (parseInt(document.getElementById('minStudyGoal').value) || 4) * 60;
      const targetEfficiency = parseInt(document.getElementById('targetEfficiency').value) || 50;
      const teamGoal = parseInt(document.getElementById('teamGoal').value) || 55;

      let totalTeamStudy = 0;
      let totalTeamScreen = 0;
      let goalsMet = 0;

      members.forEach(member => {
        let totalStudy = 0;
        let totalScreen = 0;
        const dailyData = [];

        for (let day = 1; day <= 3; day++) {
          const studyH = parseInt(document.getElementById(`m${member.id}d${day}StudyH`).value) || 0;
          const studyM = parseInt(document.getElementById(`m${member.id}d${day}StudyM`).value) || 0;
          const screenH = parseInt(document.getElementById(`m${member.id}d${day}ScreenH`).value) || 0;
          const screenM = parseInt(document.getElementById(`m${member.id}d${day}ScreenM`).value) || 0;

          const dayStudy = studyH * 60 + studyM;
          const dayScreen = screenH * 60 + screenM;
          const dayPercentage = dayScreen > 0 ? (dayStudy / dayScreen * 100) : 0;

          dailyData.push({ day, study: dayStudy, screen: dayScreen, percentage: dayPercentage });
          totalStudy += dayStudy;
          totalScreen += dayScreen;
        }

        totalTeamStudy += totalStudy;
        totalTeamScreen += totalScreen;

        const percentage = totalScreen > 0 ? (totalStudy / totalScreen * 100) : 0;
        const avgDailyStudy = totalStudy / 3;
        const metGoal = avgDailyStudy >= minStudyGoal && percentage >= targetEfficiency;
        if (metGoal) goalsMet++;

        results.push({
          member,
          study: totalStudy,
          screen: totalScreen,
          percentage,
          dailyData,
          metGoal,
          avgDailyStudy
        });
      });

      currentResults = results;
      showResults(results, totalTeamStudy, totalTeamScreen, goalsMet, teamGoal);
      saveProgress();
    }

    function showResults(results, totalStudy, totalScreen, goalsMet, teamGoal) {
      results.sort((a, b) => b.percentage - a.percentage);
      document.getElementById('resultsSection').style.display = 'block';
      document.getElementById('exportSection').style.display = 'block';

      const teamPercentage = totalScreen > 0 ? (totalStudy / totalScreen * 100) : 0;
      const avgPercentage = results.reduce((sum, r) => sum + r.percentage, 0) / results.length;

      // Team Stats
      document.getElementById('teamStats').innerHTML = `
        <div class="stat-card">
          <div>üèÜ Team Average</div>
          <div class="stat-value">${avgPercentage.toFixed(1)}%</div>
          <div>${teamPercentage >= teamGoal ? 'üéØ Goal Achieved!' : `üìà ${(teamGoal - teamPercentage).toFixed(1)}% to go`}</div>
        </div>
        <div class="stat-card">
          <div>üìö Total Study</div>
          <div class="stat-value">${Math.floor(totalStudy / 60)}h</div>
          <div>${totalStudy % 60}m across team</div>
        </div>
        <div class="stat-card">
          <div>‚úÖ Goals Met</div>
          <div class="stat-value">${goalsMet}/7</div>
          <div>${Math.round((goalsMet/7)*100)}% success rate</div>
        </div>
        <div class="stat-card">
          <div>‚ö° Efficiency</div>
          <div class="stat-value">${teamPercentage.toFixed(1)}%</div>
          <div>Team performance ratio</div>
        </div>
      `;

      // Achievements
      const achievements = calculateAchievements(results, teamPercentage, teamGoal);
      document.getElementById('achievementsContainer').innerHTML = achievements.map(ach => `
        <div class="badge">${ach}</div>
      `).join('');

      // Recommendations
      document.getElementById('recommendationsContainer').innerHTML = `
        <h3>üí° Smart Recommendations</h3>
        ${generateRecommendations(results)}
      `;

      // Rankings
      document.getElementById('rankingsContainer').innerHTML = results.map((result, index) => {
        const rank = index + 1;
        const studyH = Math.floor(result.study / 60);
        const studyM = result.study % 60;
        const productivityScore = calculateProductivityScore(result);

        return `
          <div class="ranking-card ${rank === 1 ? 'rank-1' : rank === results.length ? 'rank-last' : ''}">
            <div style="color: ${result.member.color}; font-weight: bold; font-size: 1.2em;">
              ${result.member.name}
            </div>
            <div class="percentage">${result.percentage.toFixed(1)}%</div>
            <div>üìö ${studyH}h ${studyM}m total study</div>
            <div>‚≠ê Productivity: ${productivityScore}/100</div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${Math.min(result.percentage, 100)}%;"></div>
            </div>
            <div style="margin-top: 15px; font-weight: bold; font-size: 1.1em;">
              Rank: #${rank} ${rank === 1 ? 'üëë' : result.metGoal ? '‚úÖ' : 'üí™'}
            </div>
            ${result.metGoal ? '<div style="color: #4ade80; margin-top: 5px;">‚úÖ Goals Achieved</div>' : 
              `<div style="color: #fbbf24; margin-top: 5px;">üéØ ${(minStudyGoal/60 - result.avgDailyStudy/60).toFixed(1)}h more needed</div>`}
          </div>
        `;
      }).join('');

      document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
    }

    function calculateAchievements(results, teamPercentage, teamGoal) {
      const achievements = [];
      const top = results[0];

      if (top.percentage > 60) achievements.push("üëë Study Champion");
      if (results.filter(r => r.metGoal).length >= 5) achievements.push("üìö Consistent Team");
      if (teamPercentage >= teamGoal) achievements.push("üèÜ Team Goal Achieved");
      if (results.every(r => r.percentage > 30)) achievements.push("‚ö° Balanced Team");
      if (top.percentage > 70) achievements.push("üéØ Productivity Master");
      if (results.filter(r => r.percentage > 45).length >= 4) achievements.push("üåü High Performers");

      return achievements;
    }

    function generateRecommendations(results) {
      const recommendations = [];
      const lowPerformers = results.filter(r => r.percentage < 40);
      const highPerformers = results.filter(r => r.percentage > 60);

      if (lowPerformers.length > 0) {
        lowPerformers.forEach(member => {
          const needed = Math.max(0, 40 - member.percentage);
          recommendations.push(
            `<div class="recommendation">üí° <strong>${member.member.name}:</strong> Focus on reducing screen time by ${(needed/100 * member.screen/60).toFixed(1)} hours to reach 40% efficiency</div>`
          );
        });
      }

      if (highPerformers.length > 0) {
        recommendations.push(
          `<div class="recommendation">üåü <strong>High performers:</strong> ${highPerformers.map(m => m.member.name).join(', ')} are setting great examples!</div>`
        );
      }

      const avgStudy = results.reduce((sum, r) => sum + r.study, 0) / results.length / 60 / 3;
      if (avgStudy < 4) {
        recommendations.push(
          `<div class="recommendation">üéØ <strong>Team:</strong> Try increasing daily study time by ${(4 - avgStudy).toFixed(1)} hours per person</div>`
        );
      }

      return recommendations.join('');
    }

    function calculateProductivityScore(result) {
      const efficiencyScore = Math.min(result.percentage, 100);
      const consistencyScore = result.dailyData.filter(d => d.percentage > 30).length * 25;
      const goalBonus = result.metGoal ? 20 : 0;
      
      return Math.min(efficiencyScore + consistencyScore + goalBonus, 100);
    }

    function saveProgress() {
      const data = {
        members: {},
        goals: {
          minStudy: document.getElementById('minStudyGoal').value,
          targetEff: document.getElementById('targetEfficiency').value,
          teamGoal: document.getElementById('teamGoal').value
        },
        adminUnlocked: adminUnlocked
      };

      members.forEach(member => {
        data.members[member.id] = {};
        for (let day = 1; day <= 3; day++) {
          data.members[member.id][day] = {
            studyH: document.getElementById(`m${member.id}d${day}StudyH`).value,
            studyM: document.getElementById(`m${member.id}d${day}StudyM`).value,
            screenH: document.getElementById(`m${member.id}d${day}ScreenH`).value,
            screenM: document.getElementById(`m${member.id}d${day}ScreenM`).value
          };
        }
      });

      localStorage.setItem('studyTeamData', JSON.stringify(data));
      showNotification('Progress saved successfully!', 'success');
    }

    function loadSavedData() {
      const saved = localStorage.getItem('studyTeamData');
      if (saved) {
        const data = JSON.parse(saved);
        
        // Load goals
        if (data.goals) {
          document.getElementById('minStudyGoal').value = data.goals.minStudy || 4;
          document.getElementById('targetEfficiency').value = data.goals.targetEff || 50;
          document.getElementById('teamGoal').value = data.goals.teamGoal || 55;
        }

        // Load admin state
        if (data.adminUnlocked) {
          adminUnlocked = data.adminUnlocked;
          toggleAdminLock();
        }

        // Load member data
        if (data.members) {
          members.forEach(member => {
            for (let day = 1; day <= 3; day++) {
              if (data.members[member.id] && data.members[member.id][day]) {
                document.getElementById(`m${member.id}d${day}StudyH`).value = data.members[member.id][day].studyH;
                document.getElementById(`m${member.id}d${day}StudyM`).value = data.members[member.id][day].studyM;
                document.getElementById(`m${member.id}d${day}ScreenH`).value = data.members[member.id][day].screenH;
                document.getElementById(`m${member.id}d${day}ScreenM`).value = data.members[member.id][day].screenM;
                updateDayStatus(member.id, day);
              }
            }
          });
        }
      }
    }

    function showExportOptions() {
      document.getElementById('exportSection').style.display = 'block';
      document.getElementById('exportSection').scrollIntoView({ behavior: 'smooth' });
    }

    function exportToPDF() {
      if (!currentResults) {
        showNotification('Please calculate results first!', 'error');
        return;
      }

      showNotification('Generating PDF report...', 'info');
      
      const pdf = new jsPDF();
      const date = new Date().toLocaleDateString();
      
      // Title
      pdf.setFontSize(20);
      pdf.setTextColor(76, 201, 240);
      pdf.text('Study Analytics Pro - Team Report', 20, 30);
      
      pdf.setFontSize(12);
      pdf.setTextColor(100, 100, 100);
      pdf.text(`Generated on: ${date}`, 20, 40);
      
      // Team Summary
      pdf.setFontSize(16);
      pdf.setTextColor(0, 0, 0);
      pdf.text('Team Performance Summary', 20, 60);
      
      let yPosition = 80;
      
      // Add team statistics
      pdf.setFontSize(10);
      currentResults.forEach((result, index) => {
        if (yPosition > 250) {
          pdf.addPage();
          yPosition = 20;
        }
        
        pdf.setTextColor(0, 0, 0);
        pdf.text(`${index + 1}. ${result.member.name}:`, 20, yPosition);
        pdf.text(`Efficiency: ${result.percentage.toFixed(1)}%`, 80, yPosition);
        pdf.text(`Study Time: ${Math.floor(result.study/60)}h ${result.study%60}m`, 130, yPosition);
        pdf.text(`Rank: #${index + 1}`, 180, yPosition);
        
        yPosition += 15;
      });
      
      // Save the PDF
      pdf.save(`study_report_${date.replace(/\//g, '-')}.pdf`);
      showNotification('PDF report downloaded successfully!', 'success');
    }

    function exportToCSV() {
      let csv = 'Member,Day,Study Hours,Study Minutes,Screen Hours,Screen Minutes,Efficiency,Goals Met\n';
      
      members.forEach(member => {
        for (let day = 1; day <= 3; day++) {
          const studyH = document.getElementById(`m${member.id}d${day}StudyH`).value || 0;
          const studyM = document.getElementById(`m${member.id}d${day}StudyM`).value || 0;
          const screenH = document.getElementById(`m${member.id}d${day}ScreenH`).value || 0;
          const screenM = document.getElementById(`m${member.id}d${day}ScreenM`).value || 0;
          
          const studyTotal = (parseInt(studyH) || 0) * 60 + (parseInt(studyM) || 0);
          const screenTotal = (parseInt(screenH) || 0) * 60 + (parseInt(screenM) || 0);
          const percentage = screenTotal > 0 ? (studyTotal / screenTotal * 100) : 0;
          
          csv += `${member.name},Day ${day},${studyH},${studyM},${screenH},${screenM},${percentage.toFixed(2)}%,\n`;
        }
      });

      downloadCSV(csv, 'study_team_report.csv');
      showNotification('CSV report downloaded successfully!', 'success');
    }

    function exportToImage() {
      showNotification('Generating image...', 'info');
      
      html2canvas(document.getElementById('resultsSection')).then(canvas => {
        const link = document.createElement('a');
        link.download = 'study_dashboard.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        showNotification('Dashboard image saved!', 'success');
      });
    }

    function downloadCSV(csv, filename) {
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      window.URL.revokeObjectURL(url);
    }

    function resetAll() {
      if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
        localStorage.removeItem('studyTeamData');
        members.forEach(member => {
          for (let day = 1; day <= 3; day++) {
            document.getElementById(`m${member.id}d${day}StudyH`).value = '';
            document.getElementById(`m${member.id}d${day}StudyM`).value = '';
            document.getElementById(`m${member.id}d${day}ScreenH`).value = '';
            document.getElementById(`m${member.id}d${day}ScreenM`).value = '';
            updateDayStatus(member.id, day);
          }
        });
        document.getElementById('resultsSection').style.display = 'none';
        document.getElementById('exportSection').style.display = 'none';
        showNotification('All data has been reset.', 'info');
      }
    }

    function showNotification(message, type) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    function showTutorial() {
      alert(`üéØ STUDY TRACKER TUTORIAL:

ADMIN FEATURES (Only You):
‚Ä¢ Click "Unlock to Edit Goals" to modify targets
‚Ä¢ Goals are locked by default for team members
‚Ä¢ Export reports in PDF, CSV, or Image formats

TEAM FEATURES:
‚Ä¢ Enter study/screen times for 3 days
‚Ä¢ Use "Quick Entry" for common values
‚Ä¢ Click "Calculate Analytics" for insights
‚Ä¢ "Save Progress" stores all data automatically

üìä EXPORT OPTIONS:
‚Ä¢ PDF: Professional report with rankings
‚Ä¢ CSV: Raw data for spreadsheets
‚Ä¢ Image: Dashboard screenshot

üí° TIP: Goals are admin-only to maintain consistency!`);
    }
  </script>
</body>
</html>
