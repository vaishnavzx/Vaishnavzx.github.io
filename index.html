<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Study Analytics Pro - Ultimate Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    :root {
      --primary: #4cc9f0;
      --secondary: #f72585;
      --success: #4ade80;
      --warning: #fbbf24;
      --danger: #ef4444;
      --dark: #1a1a2e;
      --darker: #16213e;
      --light: #f8fafc;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
      color: white;
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
      transition: all 0.3s ease;
    }
    
    body.light-mode {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      position: relative;
    }
    
    h1 {
      font-size: 2.8em;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
      animation: floatSlow 6s ease-in-out infinite;
    }
    
    .subtitle {
      color: #a5b4fc;
      font-size: 1.2em;
      opacity: 0.9;
    }
    
    .light-mode .subtitle {
      color: #4b5563;
    }
    
    /* Theme Toggle */
    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      transition: all 0.3s;
    }
    
    .theme-toggle:hover {
      transform: rotate(30deg);
      background: rgba(255,255,255,0.2);
    }
    
    /* View Toggles */
    .view-toggles {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .view-btn {
      padding: 10px 20px;
      border: 2px solid var(--primary);
      background: transparent;
      color: var(--primary);
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .view-btn.active {
      background: var(--primary);
      color: white;
    }
    
/* Admin Section - Fixed for Mobile */
.admin-section {
  background: linear-gradient(135deg, rgba(76, 201, 240, 0.1), rgba(247, 37, 133, 0.1));
  padding: 20px;
  border-radius: 15px;
  margin: 20px 0;
  border-left: 4px solid var(--primary);
  position: relative;
  padding-top: 60px; /* Add space at top for the badge */
}

.light-mode .admin-section {
  background: linear-gradient(135deg, rgba(76, 201, 240, 0.15), rgba(247, 37, 133, 0.15));
}

.admin-badge {
  position: absolute;
  top: 15px; /* Reduced from 10px */
  right: 15px; /* Reduced from 10px */
  background: var(--primary);
  color: white;
  padding: 8px 12px; /* Slightly larger padding */
  border-radius: 20px;
  font-size: 0.75em; /* Smaller font size */
  font-weight: bold;
  max-width: 140px; /* Limit width */
  text-align: center;
  line-height: 1.2;
  word-wrap: break-word;
}

/* Mobile-specific fix */
@media (max-width: 768px) {
  .admin-section {
    padding-top: 70px; /* Even more space on mobile */
  }
  
  .admin-badge {
    top: 12px;
    right: 12px;
    font-size: 0.7em; /* Even smaller on mobile */
    padding: 6px 10px;
    max-width: 120px;
  }
  
  .admin-section h3 {
    font-size: 1.1em; /* Slightly smaller heading on mobile */
    margin-right: 130px; /* Make space for the badge */
  }
}

@media (max-width: 480px) {
  .admin-badge {
    font-size: 0.65em;
    max-width: 110px;
    padding: 5px 8px;
  }
  
  .admin-section h3 {
    margin-right: 120px;
    font-size: 1em;
  }
}
    
    .admin-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .admin-input {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      padding: 12px;
      color: white;
      width: 100%;
    }
    
    .light-mode .admin-input {
      background: rgba(255, 255, 255, 0.8);
      color: #333;
      border: 1px solid #ddd;
    }
    
    .admin-input:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .lock-toggle {
      background: var(--warning);
      color: var(--dark);
      border: none;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: bold;
      margin-top: 10px;
    }
    
    /* Controls */
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 30px 0;
    }
    
    .btn {
      padding: 15px 20px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }
    
    .btn-primary { background: linear-gradient(135deg, var(--primary), #4361ee); }
    .btn-success { background: linear-gradient(135deg, var(--success), #22c55e); }
    .btn-warning { background: linear-gradient(135deg, var(--warning), #d97706); }
    .btn-danger { background: linear-gradient(135deg, var(--danger), #dc2626); }
    .btn-secondary { background: linear-gradient(135deg, #a855f7, #7c3aed); }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Quick Actions */
    .quick-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .quick-btn {
      padding: 10px 15px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .light-mode .quick-btn {
      background: rgba(255,255,255,0.8);
      color: #333;
      border: 1px solid #ddd;
    }
    
    .quick-btn:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .light-mode .quick-btn:hover {
      background: rgba(255,255,255,1);
    }
    
    /* Members Grid */
    .members-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .member-card {
      background: rgba(30, 30, 46, 0.9);
      padding: 20px;
      border-radius: 15px;
      border-left: 4px solid;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
      opacity: 0;
      transform: translateY(12px);
      animation: slideUp 600ms cubic-bezier(.2,.9,.2,1) var(--delay, 0s) forwards;
    }
    
    .light-mode .member-card {
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    
    .member-card:hover {
      transform: translateY(-5px);
    }
    
    .member-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .member-name {
      font-weight: bold;
      font-size: 1.3em;
    }
    
    .member-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2em;
      animation: pulse 3.5s ease-in-out infinite;
    }
    
    .day-section {
      background: rgba(44, 44, 64, 0.6);
      padding: 15px;
      border-radius: 10px;
      margin: 12px 0;
    }
    
    .light-mode .day-section {
      background: rgba(255, 255, 255, 0.6);
    }
    
    .day-header {
      color: var(--warning);
      font-weight: bold;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .input-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .input-label {
      font-size: 0.85em;
      color: #a5b4fc;
      font-weight: 500;
    }
    
    .light-mode .input-label {
      color: #4b5563;
    }
    
    input {
      padding: 10px;
      border: 1px solid #4b5563;
      border-radius: 8px;
      background: rgba(30, 30, 46, 0.9);
      color: white;
      text-align: center;
      transition: border-color 0.3s;
    }
    
    .light-mode input {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      border: 1px solid #ddd;
    }
    
    input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.1);
    }
    
    /* Results Section */
    .results-section {
      background: rgba(30, 30, 46, 0.9);
      padding: 30px;
      border-radius: 20px;
      margin-top: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .light-mode .results-section {
      background: rgba(255, 255, 255, 0.9);
    }
    
    .results-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #4361ee, #3a0ca3);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      transition: transform 0.3s;
      opacity: 0;
      transform: translateY(10px);
      transition: all 420ms cubic-bezier(.2,.9,.2,1);
    }
    
    .stat-card.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .stat-card:hover {
      transform: scale(1.05);
    }
    
    .stat-value {
      font-size: 2.2em;
      font-weight: bold;
      margin: 10px 0;
    }
    
    /* Charts Section */
    .charts-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .chart-container {
      background: rgba(44, 44, 64, 0.6);
      padding: 20px;
      border-radius: 15px;
      height: 300px;
    }
    
    .light-mode .chart-container {
      background: rgba(255, 255, 255, 0.6);
    }
    
    /* Daily Breakdown */
    .daily-breakdown {
      margin: 30px 0;
    }
    
    .day-results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .day-result-card {
      background: rgba(44, 44, 64, 0.6);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      opacity: 0;
      transform: translateY(10px);
      transition: all 420ms cubic-bezier(.2,.9,.2,1);
    }
    
    .light-mode .day-result-card {
      background: rgba(255, 255, 255, 0.6);
    }
    
    .day-result-card.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Rankings */
    .rankings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .ranking-card {
      background: rgba(44, 44, 64, 0.8);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      transition: all 0.3s;
      border: 2px solid transparent;
      opacity: 0;
      transform: translateY(10px);
      transition: all 420ms cubic-bezier(.2,.9,.2,1);
    }
    
    .light-mode .ranking-card {
      background: rgba(255, 255, 255, 0.8);
    }
    
    .ranking-card.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .ranking-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
    }
    
    .rank-1 {
      border-color: var(--warning);
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(44, 44, 64, 0.9));
      position: relative;
    }
    
    .light-mode .rank-1 {
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(255, 255, 255, 0.9));
    }
    
    .rank-1::before {
      content: "üëë";
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2.5em;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
    }
    
    .rank-last {
      border-color: var(--danger);
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(44, 44, 64, 0.9));
    }
    
    .light-mode .rank-last {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(255, 255, 255, 0.9));
    }
    
    .percentage {
      font-size: 2.8em;
      font-weight: bold;
      margin: 15px 0;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .progress-bar {
      width: 100%;
      height: 10px;
      background: #374151;
      border-radius: 10px;
      margin: 15px 0;
      overflow: hidden;
    }
    
    .light-mode .progress-bar {
      background: #e5e7eb;
    }
    
    .progress-fill {
      height: 100%;
      border-radius: 10px;
      transition: width 0.8s ease;
      background: linear-gradient(90deg, var(--primary), var(--success));
      width: 0;
    }
    
    /* Achievements */
    .achievements {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin: 25px 0;
    }
    
    .badge {
      background: linear-gradient(135deg, var(--warning), var(--danger));
      padding: 10px 18px;
      border-radius: 25px;
      font-size: 0.9em;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Recommendations */
    .recommendations {
      background: linear-gradient(135deg, rgba(76, 201, 240, 0.1), rgba(247, 37, 133, 0.1));
      padding: 20px;
      border-radius: 15px;
      margin: 25px 0;
      border-left: 4px solid var(--primary);
    }
    
    .light-mode .recommendations {
      background: linear-gradient(135deg, rgba(76, 201, 240, 0.15), rgba(247, 37, 133, 0.15));
    }
    
    .recommendation {
      margin: 10px 0;
      padding: 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }
    
    .light-mode .recommendation {
      background: rgba(0,0,0,0.05);
    }
    
    /* Export Section */
    .export-section {
      text-align: center;
      margin-top: 30px;
      padding: 20px;
      background: rgba(44, 44, 64, 0.6);
      border-radius: 15px;
    }
    
    .light-mode .export-section {
      background: rgba(255, 255, 255, 0.6);
    }
    
    .export-options {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    /* Streaks & Gamification */
    .streaks-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }
    
    .streak-card {
      background: rgba(44, 44, 64, 0.6);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
    }
    
    .light-mode .streak-card {
      background: rgba(255, 255, 255, 0.6);
    }
    
    .streak-count {
      font-size: 3em;
      font-weight: bold;
      margin: 10px 0;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.success { background: var(--success); }
    .notification.error { background: var(--danger); }
    .notification.info { background: var(--primary); }
    
    /* Animations */
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    @keyframes floatSlow {
      0% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
      100% { transform: translateY(0); }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.06); }
      100% { transform: scale(1); }
    }

    .ripple {
      position: absolute;
      border-radius: 50%;
      transform: scale(0);
      pointer-events: none;
      opacity: 0.8;
      animation: ripple 600ms linear;
    }
    
    @keyframes ripple { 
      to { transform: scale(4); opacity: 0; } 
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .members-grid {
        grid-template-columns: 1fr;
      }
      
      .controls {
        grid-template-columns: 1fr;
      }
      
      .export-options {
        flex-direction: column;
        align-items: center;
      }
      
      .charts-section {
        grid-template-columns: 1fr;
      }
      
      h1 {
        font-size: 2.2em;
      }
      
      .theme-toggle {
        position: relative;
        top: 0;
        right: 0;
        margin: 10px auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
      <h1>üéØ Study Analytics Pro</h1>
      <p class="subtitle">Ultimate Team Dashboard ‚Ä¢ Advanced Analytics & Gamification</p>
    </header>

    <!-- Admin Section - Only You Can Modify -->
    <div class="admin-section">
      <div class="admin-badge">ADMIN CONTROLS</div>
      <h3>‚öôÔ∏è Study Goals & Settings</h3>
      <div class="admin-controls">
        <div>
          <div class="input-label">Minimum Daily Study (hours)</div>
          <input type="number" id="minStudyGoal" value="4" min="1" max="12" class="admin-input" disabled>
        </div>
        <div>
          <div class="input-label">Target Efficiency (%)</div>
          <input type="number" id="targetEfficiency" value="50" min="10" max="100" class="admin-input" disabled>
        </div>
        <div>
          <div class="input-label">Team Challenge Goal (%)</div>
          <input type="number" id="teamGoal" value="55" min="10" max="100" class="admin-input" disabled>
        </div>
      </div>
      <button class="lock-toggle" onclick="toggleAdminLock()">üîì Unlock to Edit Goals</button>
    </div>

    <!-- View Toggles -->
    <div class="view-toggles">
      <button class="view-btn active" data-view="input" onclick="switchView('input', this)">üìù Input Data</button>
      <button class="view-btn" data-view="results" onclick="switchView('results', this)">üìä View Results</button>
      <button class="view-btn" data-view="analytics" onclick="switchView('analytics', this)">üìà Advanced Analytics</button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button class="quick-btn" onclick="fillSampleData()">üé≤ Sample Data</button>
      <button class="quick-btn" onclick="quickEntryMode()">‚ö° Quick Entry</button>
      <button class="quick-btn" onclick="startPomodoro()">‚è±Ô∏è Pomodoro Timer</button>
      <button class="quick-btn" onclick="showTutorial()">üìö Tutorial</button>
      <button class="quick-btn" onclick="showStudyTips()">üí° Study Tips</button>
    </div>

    <!-- Main Controls -->
    <div class="controls">
      <button class="btn btn-primary" onclick="calculateResults()">
        <span>üìà</span> Calculate Analytics
      </button>
      <button class="btn btn-success" onclick="saveProgress()">
        <span>üíæ</span> Save Progress
      </button>
      <button class="btn btn-secondary" onclick="showExportOptions()">
        <span>üìä</span> Export Reports
      </button>
      <button class="btn btn-danger" onclick="resetAll()">
        <span>üîÑ</span> Reset All
      </button>
    </div>

    <!-- Members Input -->
    <div id="inputView">
      <div class="members-grid" id="membersContainer"></div>
    </div>

    <!-- Results Section -->
    <div id="resultsView" style="display: none;">
      <div class="results-section">
        <div class="results-header">
          <h2>üèÜ Team Performance Dashboard</h2>
          <p>Comprehensive analysis based on 3 days of tracking</p>
        </div>

        <!-- Team Stats -->
        <div class="stats-grid" id="teamStats"></div>

        <!-- Streaks & Gamification -->
        <div class="streaks-section" id="streaksContainer"></div>

        <!-- Daily Breakdown -->
        <div class="daily-breakdown">
          <h3>üìÖ Daily Performance</h3>
          <div class="day-results" id="dailyResults"></div>
        </div>

        <!-- Achievements -->
        <div class="achievements" id="achievementsContainer"></div>

        <!-- Recommendations -->
        <div class="recommendations" id="recommendationsContainer"></div>

        <!-- Rankings -->
        <div class="rankings-grid" id="rankingsContainer"></div>

        <!-- Export Options -->
        <div class="export-section" id="exportSection" style="display: none;">
          <h3>üì• Export Reports</h3>
          <p>Choose your preferred format:</p>
          <div class="export-options">
            <button class="btn btn-warning" onclick="exportToPDF()">
              <span>üìÑ</span> Download PDF Report
            </button>
            <button class="btn btn-success" onclick="exportToCSV()">
              <span>üìä</span> Download CSV Data
            </button>
            <button class="btn btn-primary" onclick="exportToImage()">
              <span>üñºÔ∏è</span> Save as Image
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Advanced Analytics View -->
    <div id="analyticsView" style="display: none;">
      <div class="results-section">
        <div class="results-header">
          <h2>üìà Advanced Analytics</h2>
          <p>Deep insights and trend analysis</p>
        </div>

        <div class="charts-section">
          <div class="chart-container">
            <canvas id="efficiencyChart"></canvas>
          </div>
          <div class="chart-container">
            <canvas id="trendChart"></canvas>
          </div>
          <div class="chart-container">
            <canvas id="comparisonChart"></canvas>
          </div>
          <div class="chart-container">
            <canvas id="productivityChart"></canvas>
          </div>
        </div>

        <div class="stats-grid" id="analyticsStats"></div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div id="notification" class="notification"></div>

  <!-- Pomodoro Timer Modal -->
  <div id="pomodoroModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1001; justify-content: center; align-items: center;">
    <div style="background: var(--darker); padding: 30px; border-radius: 20px; text-align: center; max-width: 400px;">
      <h2>‚è±Ô∏è Pomodoro Timer</h2>
      <div id="pomodoroTimer" style="font-size: 3em; margin: 20px 0;">25:00</div>
      <div style="margin: 15px 0;">
        <label style="display: block; margin-bottom: 8px;">Set Timer Duration (minutes):</label>
        <input type="number" id="pomodoroMinutes" value="25" min="1" max="120" style="width: 80px; padding: 8px; text-align: center; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white;">
      </div>
      <div style="display: flex; gap: 10px; justify-content: center;">
        <button class="btn btn-success" onclick="startPomodoroTimer()">Start</button>
        <button class="btn btn-warning" onclick="pausePomodoroTimer()">Pause</button>
        <button class="btn btn-danger" onclick="closePomodoro()">Close</button>
      </div>
      <p style="margin-top: 15px; opacity: 0.8;" id="pomodoroDescription">Focus for 25 minutes, then take a 5-minute break</p>
    </div>
  </div>

  <script>
    // Initialize jsPDF
    const { jsPDF } = window.jspdf;

    const members = [
      { id: 1, name: "ABHINAV AP", color: "#4cc9f0", avatar: "A", points: 0, streak: 0 },
      { id: 2, name: "VAISHNAV C", color: "#f72585", avatar: "V", points: 0, streak: 0 },
      { id: 3, name: "ALAN JACOB", color: "#4ade80", avatar: "A", points: 0, streak: 0 },
      { id: 4, name: "MUHAMMED ZAMEEL U", color: "#fbbf24", avatar: "M", points: 0, streak: 0 },
      { id: 5, name: "JOEL PB", color: "#a855f7", avatar: "J", points: 0, streak: 0 },
      { id: 6, name: "JIMIL GEORGE", color: "#06d6a0", avatar: "J", points: 0, streak: 0 },
      { id: 7, name: "AROMAL AM", color: "#ff6b6b", avatar: "A", points: 0, streak: 0 }
    ];

    let adminUnlocked = false;
    let currentResults = null;
    let pomodoroInterval = null;
    let pomodoroTimeLeft = 25 * 60;
    let isPomodoroRunning = false;

    // IntersectionObserver for animations
    const observerOptions = {
      root: null,
      rootMargin: "0px",
      threshold: 0.15
    };

    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('show');
          obs.unobserve(entry.target);
        }
      });
    }, observerOptions);

    // Initialize
    loadMemberCards();
    loadSavedData();
    setupRippleEffects();

    function toggleTheme() {
      document.body.classList.toggle('light-mode');
      const isLight = document.body.classList.contains('light-mode');
      localStorage.setItem('studyTheme', isLight ? 'light' : 'dark');
      showNotification(`Switched to ${isLight ? 'light' : 'dark'} mode`, 'info');
    }

    function switchView(view, btn) {
      document.getElementById('inputView').style.display = view === 'input' ? 'block' : 'none';
      document.getElementById('resultsView').style.display = view === 'results' ? 'block' : 'none';
      document.getElementById('analyticsView').style.display = view === 'analytics' ? 'block' : 'none';

      document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
      if (btn) {
        btn.classList.add('active');
      } else {
        const fallback = document.querySelector(`.view-btn[data-view="${view}"]`);
        if (fallback) fallback.classList.add('active');
      }

      if (view === 'analytics' && currentResults) {
        renderAdvancedCharts();
      }
    }

    function toggleAdminLock() {
      adminUnlocked = !adminUnlocked;
      const inputs = document.querySelectorAll('.admin-input');
      const button = document.querySelector('.lock-toggle');
      
      inputs.forEach(input => {
        input.disabled = !adminUnlocked;
      });
      
      if (adminUnlocked) {
        button.innerHTML = 'üîí Lock Goals';
        button.style.background = '#ef4444';
        showNotification('Admin mode unlocked! You can now modify goals.', 'success');
      } else {
        button.innerHTML = 'üîì Unlock to Edit Goals';
        button.style.background = '#fbbf24';
        showNotification('Admin mode locked. Goals are secure.', 'info');
      }
    }

    function loadMemberCards() {
      const container = document.getElementById('membersContainer');
      container.innerHTML = '';

      members.forEach((member, idx) => {
        const card = `
          <div class="member-card" style="border-left-color: ${member.color}; --delay: ${idx * 0.08}s">
            <div class="member-header">
              <div class="member-name" style="color: ${member.color}">
                ${member.name}
                <div style="font-size: 0.7em; opacity: 0.8;">‚≠ê ${member.points} pts ‚Ä¢ üî• ${member.streak} days</div>
              </div>
              <div class="member-avatar" style="background: ${member.color}">
                ${member.avatar}
              </div>
            </div>
            
            ${[1, 2, 3].map(day => `
              <div class="day-section">
                <div class="day-header">
                  <span>üìÖ Day ${day}</span>
                  <span style="font-size: 0.8em; opacity: 0.7;" id="m${member.id}d${day}Status"></span>
                </div>
                <div class="input-grid">
                  <div class="input-group">
                    <div class="input-label">üìö Study Hours</div>
                    <input type="number" id="m${member.id}d${day}StudyH" placeholder="0" min="0" 
                           onchange="updateDayStatus(${member.id}, ${day})">
                  </div>
                  <div class="input-group">
                    <div class="input-label">Study Minutes</div>
                    <input type="number" id="m${member.id}d${day}StudyM" placeholder="0" min="0" max="59"
                           onchange="updateDayStatus(${member.id}, ${day})">
                  </div>
                  <div class="input-group">
                    <div class="input-label">üì± Screen Hours</div>
                    <input type="number" id="m${member.id}d${day}ScreenH" placeholder="0" min="0"
                           onchange="updateDayStatus(${member.id}, ${day})">
                  </div>
                  <div class="input-group">
                    <div class="input-label">Screen Minutes</div>
                    <input type="number" id="m${member.id}d${day}ScreenM" placeholder="0" min="0" max="59"
                           onchange="updateDayStatus(${member.id}, ${day})">
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        `;
        container.innerHTML += card;
      });
    }

    function updateDayStatus(memberId, day) {
      const studyH = parseInt(document.getElementById(`m${memberId}d${day}StudyH`).value) || 0;
      const studyM = parseInt(document.getElementById(`m${memberId}d${day}StudyM`).value) || 0;
      const screenH = parseInt(document.getElementById(`m${memberId}d${day}ScreenH`).value) || 0;
      const screenM = parseInt(document.getElementById(`m${memberId}d${day}ScreenM`).value) || 0;
      
      const totalStudy = studyH * 60 + studyM;
      const totalScreen = screenH * 60 + screenM;
      const percentage = totalScreen > 0 ? (totalStudy / totalScreen * 100) : 0;
      
      const statusEl = document.getElementById(`m${memberId}d${day}Status`);
      if (totalStudy > 0 || totalScreen > 0) {
        statusEl.textContent = `‚úì ${percentage.toFixed(0)}%`;
        statusEl.style.color = percentage >= 40 ? '#4ade80' : '#fbbf24';
      } else {
        statusEl.textContent = '';
      }
    }

    function fillSampleData() {
      members.forEach(member => {
        for (let day = 1; day <= 3; day++) {
          document.getElementById(`m${member.id}d${day}StudyH`).value = Math.floor(Math.random() * 4) + 2;
          document.getElementById(`m${member.id}d${day}StudyM`).value = Math.floor(Math.random() * 60);
          document.getElementById(`m${member.id}d${day}ScreenH`).value = Math.floor(Math.random() * 6) + 4;
          document.getElementById(`m${member.id}d${day}ScreenM`).value = Math.floor(Math.random() * 60);
          updateDayStatus(member.id, day);
        }
      });
      showNotification('Sample data filled! Click "Calculate Analytics" to see results.', 'success');
    }

    function quickEntryMode() {
      members.forEach(member => {
        for (let day = 1; day <= 3; day++) {
          if (!document.getElementById(`m${member.id}d${day}StudyH`).value) {
            document.getElementById(`m${member.id}d${day}StudyH`).value = 4;
            document.getElementById(`m${member.id}d${day}StudyM`).value = 30;
            document.getElementById(`m${member.id}d${day}ScreenH`).value = 6;
            document.getElementById(`m${member.id}d${day}ScreenM`).value = 0;
            updateDayStatus(member.id, day);
          }
        }
      });
      showNotification('Quick entry completed! Modify values as needed.', 'info');
    }

    function calculateResults() {
      const results = [];
      const minStudyGoal = (parseInt(document.getElementById('minStudyGoal').value) || 4) * 60;
      const targetEfficiency = parseInt(document.getElementById('targetEfficiency').value) || 50;
      const teamGoal = parseInt(document.getElementById('teamGoal').value) || 55;

      let totalTeamStudy = 0;
      let totalTeamScreen = 0;
      let goalsMet = 0;

      members.forEach(member => {
        let totalStudy = 0;
        let totalScreen = 0;
        const dailyData = [];

        for (let day = 1; day <= 3; day++) {
          const studyH = parseInt(document.getElementById(`m${member.id}d${day}StudyH`).value) || 0;
          const studyM = parseInt(document.getElementById(`m${member.id}d${day}StudyM`).value) || 0;
          const screenH = parseInt(document.getElementById(`m${member.id}d${day}ScreenH`).value) || 0;
          const screenM = parseInt(document.getElementById(`m${member.id}d${day}ScreenM`).value) || 0;

          const dayStudy = studyH * 60 + studyM;
          const dayScreen = screenH * 60 + screenM;
          const dayPercentage = dayScreen > 0 ? (dayStudy / dayScreen * 100) : 0;

          dailyData.push({ day, study: dayStudy, screen: dayScreen, percentage: dayPercentage });
          totalStudy += dayStudy;
          totalScreen += dayScreen;
        }

        totalTeamStudy += totalStudy;
        totalTeamScreen += totalScreen;

        const percentage = totalScreen > 0 ? (totalStudy / totalScreen * 100) : 0;
        const avgDailyStudy = totalStudy / 3;
        const metGoal = avgDailyStudy >= minStudyGoal && percentage >= targetEfficiency;
        if (metGoal) goalsMet++;

        // Calculate points and streaks
        const points = Math.round(percentage * 2 + (metGoal ? 50 : 0));
        const streak = metGoal ? (member.streak + 1) : 0;
        member.points = points;
        member.streak = streak;

        results.push({
          member,
          study: totalStudy,
          screen: totalScreen,
          percentage,
          dailyData,
          metGoal,
          avgDailyStudy,
          points,
          streak
        });
      });

      currentResults = results;
      showResults(results, totalTeamStudy, totalTeamScreen, goalsMet, teamGoal);
      saveProgress();
    }

    function showResults(results, totalStudy, totalScreen, goalsMet, teamGoal) {
      results.sort((a, b) => b.percentage - a.percentage);
      switchView('results');
      document.getElementById('exportSection').style.display = 'block';

      const teamPercentage = totalScreen > 0 ? (totalStudy / totalScreen * 100) : 0;
      const avgPercentage = results.reduce((sum, r) => sum + r.percentage, 0) / results.length;

      // Team Stats
      document.getElementById('teamStats').innerHTML = `
        <div class="stat-card">
          <div>üèÜ Team Average</div>
          <div class="stat-value">${avgPercentage.toFixed(1)}%</div>
          <div>${teamPercentage >= teamGoal ? 'üéØ Goal Achieved!' : `üìà ${(teamGoal - teamPercentage).toFixed(1)}% to go`}</div>
        </div>
        <div class="stat-card">
          <div>üìö Total Study</div>
          <div class="stat-value">${Math.floor(totalStudy / 60)}h</div>
          <div>${totalStudy % 60}m across team</div>
        </div>
        <div class="stat-card">
          <div>‚úÖ Goals Met</div>
          <div class="stat-value">${goalsMet}/7</div>
          <div>${Math.round((goalsMet/7)*100)}% success rate</div>
        </div>
        <div class="stat-card">
          <div>‚ö° Efficiency</div>
          <div class="stat-value">${teamPercentage.toFixed(1)}%</div>
          <div>Team performance ratio</div>
        </div>
      `;

      // Streaks & Gamification
      document.getElementById('streaksContainer').innerHTML = `
        <div class="streak-card">
          <div>üî• Longest Streak</div>
          <div class="streak-count">${Math.max(...results.map(r => r.streak))}</div>
          <div>Consecutive days meeting goals</div>
        </div>
        <div class="streak-card">
          <div>‚≠ê Total Points</div>
          <div class="streak-count">${results.reduce((sum, r) => sum + r.points, 0)}</div>
          <div>Team achievement score</div>
        </div>
        <div class="streak-card">
          <div>üöÄ Most Improved</div>
          <div class="streak-count">+${Math.max(...results.map(r => r.points - 100))}</div>
          <div>Points above baseline</div>
        </div>
      `;

      // Daily Breakdown
      const dailyResults = document.getElementById('dailyResults');
      dailyResults.innerHTML = members.map(member => {
        const result = results.find(r => r.member.id === member.id);
        return `
          <div class="day-result-card">
            <div style="color: ${member.color}; font-weight: bold;">${member.name}</div>
            ${result.dailyData.map(day => `
              <div style="margin: 5px 0; font-size: 0.9em;">
                Day ${day.day}: ${day.percentage.toFixed(1)}%
              </div>
            `).join('')}
          </div>
        `;
      }).join('');

      // Achievements
      const achievements = calculateAchievements(results, teamPercentage, teamGoal);
      document.getElementById('achievementsContainer').innerHTML = achievements.map(ach => `
        <div class="badge">${ach}</div>
      `).join('');

      // Recommendations
      document.getElementById('recommendationsContainer').innerHTML = `
        <h3>üí° Smart Recommendations</h3>
        ${generateRecommendations(results)}
      `;

      // Rankings
      document.getElementById('rankingsContainer').innerHTML = results.map((result, index) => {
        const rank = index + 1;
        const studyH = Math.floor(result.study / 60);
        const studyM = result.study % 60;
        const productivityScore = calculateProductivityScore(result);

        return `
          <div class="ranking-card ${rank === 1 ? 'rank-1' : rank === results.length ? 'rank-last' : ''}">
            <div style="color: ${result.member.color}; font-weight: bold; font-size: 1.2em;">
              ${result.member.name}
            </div>
            <div class="percentage">${result.percentage.toFixed(1)}%</div>
            <div>üìö ${studyH}h ${studyM}m total study</div>
            <div>‚≠ê ${result.points} points ‚Ä¢ üî• ${result.streak} day streak</div>
            <div class="progress-bar">
              <div class="progress-fill" data-target="${Math.min(result.percentage, 100)}" style="background: ${result.member.color};"></div>
            </div>
            <div style="margin-top: 15px; font-weight: bold; font-size: 1.1em;">
              Rank: #${rank} ${rank === 1 ? 'üëë' : result.metGoal ? '‚úÖ' : 'üí™'}
            </div>
            ${result.metGoal ? '<div style="color: #4ade80; margin-top: 5px;">‚úÖ Goals Achieved</div>' : 
              `<div style="color: #fbbf24; margin-top: 5px;">üéØ ${((minStudyGoal/60) - (result.avgDailyStudy/60)).toFixed(1)}h more needed</div>`}
          </div>
        `;
      }).join('');

      // ANIMATIONS - Called after DOM creation
      setTimeout(() => {
        animateProgressBars();
        revealStagger('.stat-card', 80);
        revealStagger('.streak-card', 60);
        revealStagger('.ranking-card', 70);
        revealStagger('.day-result-card', 60);
        
        // Set up intersection observer for newly created elements
        document.querySelectorAll('.stat-card, .ranking-card, .day-result-card, .streak-card').forEach((el, i) => {
          el.style.transitionDelay = `${i * 0.1}s`;
          observer.observe(el);
        });
      }, 100);
    }

    function renderAdvancedCharts() {
      // Efficiency Distribution Chart
      const efficiencyCtx = document.getElementById('efficiencyChart').getContext('2d');
      new Chart(efficiencyCtx, {
        type: 'bar',
        data: {
          labels: currentResults.map(r => r.member.name),
          datasets: [{
            label: 'Efficiency %',
            data: currentResults.map(r => r.percentage),
            backgroundColor: currentResults.map(r => r.member.color),
            borderColor: currentResults.map(r => r.member.color),
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Member Efficiency Distribution'
            }
          }
        }
      });

      // Trend Analysis Chart
      const trendCtx = document.getElementById('trendChart').getContext('2d');
      new Chart(trendCtx, {
        type: 'line',
        data: {
          labels: ['Day 1', 'Day 2', 'Day 3'],
          datasets: currentResults.slice(0, 3).map(result => ({
            label: result.member.name,
            data: result.dailyData.map(d => d.percentage),
            borderColor: result.member.color,
            tension: 0.3
          }))
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Top 3 Members - Daily Trends'
            }
          }
        }
      });
    }

    function calculateAchievements(results, teamPercentage, teamGoal) {
      const achievements = [];
      const top = results[0];

      if (top.percentage > 60) achievements.push("üëë Study Champion");
      if (results.filter(r => r.metGoal).length >= 5) achievements.push("üìö Consistent Team");
      if (teamPercentage >= teamGoal) achievements.push("üèÜ Team Goal Achieved");
      if (results.every(r => r.percentage > 30)) achievements.push("‚ö° Balanced Team");
      if (top.percentage > 70) achievements.push("üéØ Productivity Master");
      if (results.filter(r => r.percentage > 45).length >= 4) achievements.push("üåü High Performers");
      if (Math.max(...results.map(r => r.streak)) >= 3) achievements.push("üî• Streak Masters");
      if (results.reduce((sum, r) => sum + r.points, 0) > 2000) achievements.push("‚≠ê Point Champions");

      return achievements;
    }

    function generateRecommendations(results) {
      const recommendations = [];
      const lowPerformers = results.filter(r => r.percentage < 40);
      const highPerformers = results.filter(r => r.percentage > 60);

      if (lowPerformers.length > 0) {
        lowPerformers.forEach(member => {
          const needed = Math.max(0, 40 - member.percentage);
          recommendations.push(
            `<div class="recommendation">üí° <strong>${member.member.name}:</strong> Focus on reducing screen time by ${(needed/100 * member.screen/60).toFixed(1)} hours to reach 40% efficiency</div>`
          );
        });
      }

      if (highPerformers.length > 0) {
        recommendations.push(
          `<div class="recommendation">üåü <strong>High performers:</strong> ${highPerformers.map(m => m.member.name).join(', ')} are setting great examples!</div>`
        );
      }

      const avgStudy = results.reduce((sum, r) => sum + r.study, 0) / results.length / 60 / 3;
      if (avgStudy < 4) {
        recommendations.push(
          `<div class="recommendation">üéØ <strong>Team:</strong> Try increasing daily study time by ${(4 - avgStudy).toFixed(1)} hours per person</div>`
        );
      }

      // Streak-based recommendations
      const streakLeaders = results.filter(r => r.streak >= 2);
      if (streakLeaders.length > 0) {
        recommendations.push(
          `<div class="recommendation">üî• <strong>Streak leaders:</strong> ${streakLeaders.map(m => m.member.name).join(', ')} are maintaining great consistency!</div>`
        );
      }

      return recommendations.join('');
    }

    function calculateProductivityScore(result) {
      const efficiencyScore = Math.min(result.percentage, 100);
      const consistencyScore = result.dailyData.filter(d => d.percentage > 30).length * 25;
      const goalBonus = result.metGoal ? 20 : 0;
      
      return Math.min(efficiencyScore + consistencyScore + goalBonus, 100);
    }

    function saveProgress() {
      const data = {
        members: {},
        goals: {
          minStudy: document.getElementById('minStudyGoal').value,
          targetEff: document.getElementById('targetEfficiency').value,
          teamGoal: document.getElementById('teamGoal').value
        },
        adminUnlocked: adminUnlocked,
        theme: document.body.classList.contains('light-mode') ? 'light' : 'dark',
        memberData: members.reduce((acc, member) => {
          acc[member.id] = { points: member.points, streak: member.streak };
          return acc;
        }, {})
      };

      members.forEach(member => {
        data.members[member.id] = {};
        for (let day = 1; day <= 3; day++) {
          data.members[member.id][day] = {
            studyH: document.getElementById(`m${member.id}d${day}StudyH`).value,
            studyM: document.getElementById(`m${member.id}d${day}StudyM`).value,
            screenH: document.getElementById(`m${member.id}d${day}ScreenH`).value,
            screenM: document.getElementById(`m${member.id}d${day}ScreenM`).value
          };
        }
      });

      localStorage.setItem('studyTeamData', JSON.stringify(data));
      showNotification('Progress saved successfully!', 'success');
    }

    function loadSavedData() {
      const saved = localStorage.getItem('studyTeamData');
      if (saved) {
        const data = JSON.parse(saved);
        
        // Load theme
        if (data.theme === 'light') {
          document.body.classList.add('light-mode');
        }
        
        // Load goals
        if (data.goals) {
          document.getElementById('minStudyGoal').value = data.goals.minStudy || 4;
          document.getElementById('targetEfficiency').value = data.goals.targetEff || 50;
          document.getElementById('teamGoal').value = data.goals.teamGoal || 55;
        }

        // Load member points and streaks
        if (data.memberData) {
          members.forEach(member => {
            if (data.memberData[member.id]) {
              member.points = data.memberData[member.id].points || 0;
              member.streak = data.memberData[member.id].streak || 0;
            }
          });
        }

        // Load admin state
        if (data.adminUnlocked) {
          adminUnlocked = data.adminUnlocked;
          toggleAdminLock();
        }

        // Load member data
        if (data.members) {
          members.forEach(member => {
            for (let day = 1; day <= 3; day++) {
              if (data.members[member.id] && data.members[member.id][day]) {
                document.getElementById(`m${member.id}d${day}StudyH`).value = data.members[member.id][day].studyH;
                document.getElementById(`m${member.id}d${day}StudyM`).value = data.members[member.id][day].studyM;
                document.getElementById(`m${member.id}d${day}ScreenH`).value = data.members[member.id][day].screenH;
                document.getElementById(`m${member.id}d${day}ScreenM`).value = data.members[member.id][day].screenM;
                updateDayStatus(member.id, day);
              }
            }
          });
        }
      }
    }

    function showExportOptions() {
      document.getElementById('exportSection').style.display = 'block';
      document.getElementById('exportSection').scrollIntoView({ behavior: 'smooth' });
    }

    function exportToPDF() {
      if (!currentResults) {
        showNotification('Please calculate results first!', 'error');
        return;
      }

      showNotification('Generating PDF report...', 'info');
      
      const pdf = new jsPDF();
      const date = new Date().toLocaleDateString();
      
      // Title
      pdf.setFontSize(20);
      pdf.setTextColor(76, 201, 240);
      pdf.text('Study Analytics Pro - Team Report', 20, 30);
      
      pdf.setFontSize(12);
      pdf.setTextColor(100, 100, 100);
      pdf.text(`Generated on: ${date}`, 20, 40);
      
      // Team Summary
      pdf.setFontSize(16);
      pdf.setTextColor(0, 0, 0);
      pdf.text('Team Performance Summary', 20, 60);
      
      let yPosition = 80;
      
      // Add team statistics
      pdf.setFontSize(10);
      currentResults.forEach((result, index) => {
        if (yPosition > 250) {
          pdf.addPage();
          yPosition = 20;
        }
        
        pdf.setTextColor(0, 0, 0);
        pdf.text(`${index + 1}. ${result.member.name}:`, 20, yPosition);
        pdf.text(`Efficiency: ${result.percentage.toFixed(1)}%`, 80, yPosition);
        pdf.text(`Study Time: ${Math.floor(result.study/60)}h ${result.study%60}m`, 130, yPosition);
        pdf.text(`Rank: #${index + 1}`, 180, yPosition);
        
        yPosition += 15;
      });
      
      // Save the PDF
      pdf.save(`study_report_${date.replace(/\//g, '-')}.pdf`);
      showNotification('PDF report downloaded successfully!', 'success');
    }

    function exportToCSV() {
      let csv = 'Member,Day,Study Hours,Study Minutes,Screen Hours,Screen Minutes,Efficiency,Goals Met\n';
      
      members.forEach(member => {
        for (let day = 1; day <= 3; day++) {
          const studyH = document.getElementById(`m${member.id}d${day}StudyH`).value || 0;
          const studyM = document.getElementById(`m${member.id}d${day}StudyM`).value || 0;
          const screenH = document.getElementById(`m${member.id}d${day}ScreenH`).value || 0;
          const screenM = document.getElementById(`m${member.id}d${day}ScreenM`).value || 0;
          
          const studyTotal = (parseInt(studyH) || 0) * 60 + (parseInt(studyM) || 0);
          const screenTotal = (parseInt(screenH) || 0) * 60 + (parseInt(screenM) || 0);
          const percentage = screenTotal > 0 ? (studyTotal / screenTotal * 100) : 0;
          
          csv += `${member.name},Day ${day},${studyH},${studyM},${screenH},${screenM},${percentage.toFixed(2)}%,\n`;
        }
      });

      downloadCSV(csv, 'study_team_report.csv');
      showNotification('CSV report downloaded successfully!', 'success');
    }

    function exportToImage() {
      showNotification('Generating image...', 'info');
      
      const element = document.getElementById('resultsView');
      html2canvas(element).then(canvas => {
        const link = document.createElement('a');
        link.download = 'study_dashboard.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        showNotification('Dashboard image saved!', 'success');
      });
    }

    function downloadCSV(csv, filename) {
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      window.URL.revokeObjectURL(url);
    }

    function resetAll() {
      if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
        localStorage.removeItem('studyTeamData');
        members.forEach(member => {
          member.points = 0;
          member.streak = 0;
          for (let day = 1; day <= 3; day++) {
            document.getElementById(`m${member.id}d${day}StudyH`).value = '';
            document.getElementById(`m${member.id}d${day}StudyM`).value = '';
            document.getElementById(`m${member.id}d${day}ScreenH`).value = '';
            document.getElementById(`m${member.id}d${day}ScreenM`).value = '';
            updateDayStatus(member.id, day);
          }
        });
        document.getElementById('resultsView').style.display = 'none';
        document.getElementById('exportSection').style.display = 'none';
        switchView('input');
        showNotification('All data has been reset.', 'info');
      }
    }

    // Pomodoro Timer Functions
    function startPomodoro() {
      document.getElementById('pomodoroModal').style.display = 'flex';
      const customMinutes = parseInt(document.getElementById('pomodoroMinutes').value) || 25;
      pomodoroTimeLeft = customMinutes * 60;
      updatePomodoroDisplay();
      updatePomodoroDescription(customMinutes);
    }

    function closePomodoro() {
      document.getElementById('pomodoroModal').style.display = 'none';
      if (pomodoroInterval) {
        clearInterval(pomodoroInterval);
        isPomodoroRunning = false;
      }
    }

    function startPomodoroTimer() {
      if (!isPomodoroRunning) {
        const customMinutes = parseInt(document.getElementById('pomodoroMinutes').value) || 25;
        pomodoroTimeLeft = customMinutes * 60;
        updatePomodoroDescription(customMinutes);
        
        isPomodoroRunning = true;
        pomodoroInterval = setInterval(() => {
          pomodoroTimeLeft--;
          updatePomodoroDisplay();
          
          if (pomodoroTimeLeft <= 0) {
            clearInterval(pomodoroInterval);
            isPomodoroRunning = false;
            showNotification('Pomodoro session complete! Take a 5-minute break.', 'success');
            // Play completion sound (if available)
            if (typeof Audio !== 'undefined') {
              const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA');
              audio.play().catch(() => {});
            }
          }
        }, 1000);
      }
    }

    function pausePomodoroTimer() {
      if (pomodoroInterval) {
        clearInterval(pomodoroInterval);
        isPomodoroRunning = false;
      }
    }

    function updatePomodoroDisplay() {
      const minutes = Math.floor(pomodoroTimeLeft / 60);
      const seconds = pomodoroTimeLeft % 60;
      document.getElementById('pomodoroTimer').textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function updatePomodoroDescription(minutes) {
      document.getElementById('pomodoroDescription').textContent = 
        `Focus for ${minutes} minutes, then take a 5-minute break`;
    }

    function showNotification(message, type) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    function showTutorial() {
      alert(`üéØ STUDY ANALYTICS PRO - ULTIMATE TUTORIAL:

ADMIN FEATURES (Only You):
‚Ä¢ Click "Unlock to Edit Goals" to modify targets
‚Ä¢ Goals are locked by default for team members
‚Ä¢ Export reports in PDF, CSV, or Image formats

TEAM FEATURES:
‚Ä¢ Enter study/screen times for 3 days
‚Ä¢ Use "Quick Entry" for common values
‚Ä¢ Click "Calculate Analytics" for insights
‚Ä¢ "Save Progress" stores all data automatically

üéÆ GAMIFICATION:
‚Ä¢ Earn points for efficient study habits
‚Ä¢ Build streaks for consistent performance
‚Ä¢ Unlock achievements for milestones
‚Ä¢ Compete on the leaderboard

üìä ADVANCED ANALYTICS:
‚Ä¢ View detailed charts and trends
‚Ä¢ Compare performance across days
‚Ä¢ Get personalized recommendations
‚Ä¢ Track team progress over time

‚è±Ô∏è PRODUCTIVITY TOOLS:
‚Ä¢ Customizable Pomodoro Timer (1-120 minutes)
‚Ä¢ Dark/Light mode for comfort
‚Ä¢ Study tips and recommendations

üí° TIP: Consistent tracking leads to better insights and improved performance!`);
    }

    function showStudyTips() {
      const tips = [
        "üéØ Use the Pomodoro Technique: 25 minutes focus, 5 minutes break",
        "üìö Study in a dedicated, distraction-free environment",
        "üíß Stay hydrated - it improves cognitive function",
        "üîç Review material within 24 hours for better retention",
        "üéµ Use background music or white noise to improve focus",
        "üìù Take handwritten notes for better memory retention",
        "üîÑ Mix different subjects to prevent boredom",
        "üéØ Set specific, achievable goals for each study session",
        "üí§ Get adequate sleep - it's crucial for memory consolidation",
        "üèÉ‚Äç‚ôÇÔ∏è Take regular breaks to maintain mental freshness"
      ];
      
      const randomTip = tips[Math.floor(Math.random() * tips.length)];
      showNotification(`üí° Study Tip: ${randomTip}`, 'info');
    }

    // Animation helpers
    function animateProgressBars() {
      const fills = document.querySelectorAll('.progress-fill');
      fills.forEach((el, i) => {
        const target = Number(el.dataset.target || 0);
        setTimeout(() => { el.style.width = target + '%'; }, i * 100);
      });
    }

    function revealStagger(selector, delay = 80) {
      document.querySelectorAll(selector).forEach((el, i) => {
        setTimeout(() => el.classList.add('show'), i * delay);
      });
    }

    function setupRippleEffects() {
      document.querySelectorAll('.btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const rect = btn.getBoundingClientRect();
          const circle = document.createElement('span');
          circle.className = 'ripple';
          const size = Math.max(rect.width, rect.height);
          circle.style.width = circle.style.height = size + 'px';
          circle.style.left = (e.clientX - rect.left - size/2) + 'px';
          circle.style.top = (e.clientY - rect.top - size/2) + 'px';
          btn.appendChild(circle);
          circle.addEventListener('animationend', () => circle.remove());
        });
      });
    }
  </script>
</body>
</html>

